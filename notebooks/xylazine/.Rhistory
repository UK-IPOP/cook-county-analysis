z$z6[grep("CLONAZEPAM",z$z6)]<-"CLONAZEPAM"
z$z7[grep("CLONAZEPAM",z$z7)]<-"CLONAZEPAM"
z$z8[grep("CLONAZEPAM",z$z8)]<-"CLONAZEPAM"
z$z9[grep("CLONAZEPAM",z$z9)]<-"CLONAZEPAM"
z$z10[grep("CLONAZEPAM",z$z10)]<-"CLONAZEPAM"
z$z11[grep("CLONAZEPAM",z$z11)]<-"CLONAZEPAM"
z$z12[grep("CLONAZEPAM",z$z12)]<-"CLONAZEPAM"
z$z13[grep("CLONAZEPAM",z$z13)]<-"CLONAZEPAM"
######################
#DELORAZEPAM
#########################
z$z1[grep("DELORAZEPAM",z$z1)]<-"DEL_PAM"
z$z2[grep("DELORAZEPAM",z$z2)]<-"DEL_PAM"
z$z3[grep("DELORAZEPAM",z$z3)]<-"DEL_PAM"
z$z4[grep("DELORAZEPAM",z$z4)]<-"DEL_PAM"
z$z5[grep("DELORAZEPAM",z$z5)]<-"DEL_PAM"
z$z6[grep("DELORAZEPAM",z$z6)]<-"DEL_PAM"
z$z7[grep("DELORAZEPAM",z$z7)]<-"DEL_PAM"
z$z8[grep("DELORAZEPAM",z$z8)]<-"DEL_PAM"
z$z9[grep("DELORAZEPAM",z$z9)]<-"DEL_PAM"
z$z10[grep("DELORAZEPAM",z$z10)]<-"DEL_PAM"
z$z11[grep("DELORAZEPAM",z$z11)]<-"DEL_PAM"
z$z12[grep("DELORAZEPAM",z$z12)]<-"DEL_PAM"
z$z13[grep("DELORAZEPAM",z$z13)]<-"DEL_PAM"
######################
#DIAZEPAM [Valium]
#########################
z$z1[grep("DIAZEPAM",z$z1)]<-"DIAZEPAM"
z$z2[grep("DIAZEPAM",z$z2)]<-"DIAZEPAM"
z$z3[grep("DIAZEPAM",z$z3)]<-"DIAZEPAM"
z$z4[grep("DIAZEPAM",z$z4)]<-"DIAZEPAM"
z$z5[grep("DIAZEPAM",z$z5)]<-"DIAZEPAM"
z$z6[grep("DIAZEPAM",z$z6)]<-"DIAZEPAM"
z$z7[grep("DIAZEPAM",z$z7)]<-"DIAZEPAM"
z$z8[grep("DIAZEPAM",z$z8)]<-"DIAZEPAM"
z$z9[grep("DIAZEPAM",z$z9)]<-"DIAZEPAM"
z$z10[grep("DIAZEPAM",z$z10)]<-"DIAZEPAM"
z$z11[grep("DIAZEPAM",z$z11)]<-"DIAZEPAM"
z$z12[grep("DIAZEPAM",z$z12)]<-"DIAZEPAM"
z$z13[grep("DIAZEPAM",z$z13)]<-"DIAZEPAM"
######################
#DICLAZEPAM
#########################
z$z1[grep("DICLAZEPAM",z$z1)]<-"DICLAZEPAM"
z$z2[grep("DICLAZEPAM",z$z2)]<-"DICLAZEPAM"
z$z3[grep("DICLAZEPAM",z$z3)]<-"DICLAZEPAM"
z$z4[grep("DICLAZEPAM",z$z4)]<-"DICLAZEPAM"
z$z5[grep("DICLAZEPAM",z$z5)]<-"DICLAZEPAM"
z$z6[grep("DICLAZEPAM",z$z6)]<-"DICLAZEPAM"
z$z7[grep("DICLAZEPAM",z$z7)]<-"DICLAZEPAM"
z$z8[grep("DICLAZEPAM",z$z8)]<-"DICLAZEPAM"
z$z9[grep("DICLAZEPAM",z$z9)]<-"DICLAZEPAM"
z$z10[grep("DICLAZEPAM",z$z10)]<-"DICLAZEPAM"
z$z11[grep("DICLAZEPAM",z$z11)]<-"DICLAZEPAM"
z$z12[grep("DICLAZEPAM",z$z12)]<-"DICLAZEPAM"
z$z13[grep("DICLAZEPAM",z$z13)]<-"DICLAZEPAM"
######################
#ETIZOLAM
#########################
z$z1[grep("ETIZOLAM",z$z1)]<-"ETIZOLAM"
z$z2[grep("ETIZOLAM",z$z2)]<-"ETIZOLAM"
z$z3[grep("ETIZOLAM",z$z3)]<-"ETIZOLAM"
z$z4[grep("ETIZOLAM",z$z4)]<-"ETIZOLAM"
z$z5[grep("ETIZOLAM",z$z5)]<-"ETIZOLAM"
z$z6[grep("ETIZOLAM",z$z6)]<-"ETIZOLAM"
z$z7[grep("ETIZOLAM",z$z7)]<-"ETIZOLAM"
z$z8[grep("ETIZOLAM",z$z8)]<-"ETIZOLAM"
z$z9[grep("ETIZOLAM",z$z9)]<-"ETIZOLAM"
z$z10[grep("ETIZOLAM",z$z10)]<-"ETIZOLAM"
z$z11[grep("ETIZOLAM",z$z11)]<-"ETIZOLAM"
z$z12[grep("ETIZOLAM",z$z12)]<-"ETIZOLAM"
z$z13[grep("ETIZOLAM",z$z13)]<-"ETIZOLAM"
######################
#LORAZEPAM[Ativan]
#########################
z$z1[grep("LORAZEPAM",z$z1)]<-"LORAZEPAM"
z$z2[grep("LORAZEPAM",z$z2)]<-"LORAZEPAM"
z$z3[grep("LORAZEPAM",z$z3)]<-"LORAZEPAM"
z$z4[grep("LORAZEPAM",z$z4)]<-"LORAZEPAM"
z$z5[grep("LORAZEPAM",z$z5)]<-"LORAZEPAM"
z$z6[grep("LORAZEPAM",z$z6)]<-"LORAZEPAM"
z$z7[grep("LORAZEPAM",z$z7)]<-"LORAZEPAM"
z$z8[grep("LORAZEPAM",z$z8)]<-"LORAZEPAM"
z$z9[grep("LORAZEPAM",z$z9)]<-"LORAZEPAM"
z$z10[grep("LORAZEPAM",z$z10)]<-"LORAZEPAM"
z$z11[grep("LORAZEPAM",z$z11)]<-"LORAZEPAM"
z$z12[grep("LORAZEPAM",z$z12)]<-"LORAZEPAM"
z$z13[grep("LORAZEPAM",z$z13)]<-"LORAZEPAM"
######################
#MIDAZOLAM [Versed]
#########################
z$z1[grep("MIDAZOLAM",z$z1)]<-"MIDAZOLAM"
z$z2[grep("MIDAZOLAM",z$z2)]<-"MIDAZOLAM"
z$z3[grep("MIDAZOLAM",z$z3)]<-"MIDAZOLAM"
z$z4[grep("MIDAZOLAM",z$z4)]<-"MIDAZOLAM"
z$z5[grep("MIDAZOLAM",z$z5)]<-"MIDAZOLAM"
z$z6[grep("MIDAZOLAM",z$z6)]<-"MIDAZOLAM"
z$z7[grep("MIDAZOLAM",z$z7)]<-"MIDAZOLAM"
z$z8[grep("MIDAZOLAM",z$z8)]<-"MIDAZOLAM"
z$z9[grep("MIDAZOLAM",z$z9)]<-"MIDAZOLAM"
z$z10[grep("MIDAZOLAM",z$z10)]<-"MIDAZOLAM"
z$z11[grep("MIDAZOLAM",z$z11)]<-"MIDAZOLAM"
z$z12[grep("MIDAZOLAM",z$z12)]<-"MIDAZOLAM"
z$z13[grep("MIDAZOLAM",z$z13)]<-"MIDAZOLAM"
######################
#NORDIAZEPAM
#########################
z$z1[grep("NORDIAZEPAM",z$z1)]<-"NORDIAZEPAM"
z$z2[grep("NORDIAZEPAM",z$z2)]<-"NORDIAZEPAM"
z$z3[grep("NORDIAZEPAM",z$z3)]<-"NORDIAZEPAM"
z$z4[grep("NORDIAZEPAM",z$z4)]<-"NORDIAZEPAM"
z$z5[grep("NORDIAZEPAM",z$z5)]<-"NORDIAZEPAM"
z$z6[grep("NORDIAZEPAM",z$z6)]<-"NORDIAZEPAM"
z$z7[grep("NORDIAZEPAM",z$z7)]<-"NORDIAZEPAM"
z$z8[grep("NORDIAZEPAM",z$z8)]<-"NORDIAZEPAM"
z$z9[grep("NORDIAZEPAM",z$z9)]<-"NORDIAZEPAM"
z$z10[grep("NORDIAZEPAM",z$z10)]<-"NORDIAZEPAM"
z$z11[grep("NORDIAZEPAM",z$z11)]<-"NORDIAZEPAM"
z$z12[grep("NORDIAZEPAM",z$z12)]<-"NORDIAZEPAM"
z$z13[grep("NORDIAZEPAM",z$z13)]<-"NORDIAZEPAM"
#########################
# TEMAZEPAM[Restoril]
#########################
z$z1[grep("TEMAZEPAM",z$z1)]<-"TEMAZEPAM"
z$z2[grep("TEMAZEPAM",z$z2)]<-"TEMAZEPAM"
z$z3[grep("TEMAZEPAM",z$z3)]<-"TEMAZEPAM"
z$z4[grep("TEMAZEPAM",z$z4)]<-"TEMAZEPAM"
z$z5[grep("TEMAZEPAM",z$z5)]<-"TEMAZEPAM"
z$z6[grep("TEMAZEPAM",z$z6)]<-"TEMAZEPAM"
z$z7[grep("TEMAZEPAM",z$z7)]<-"TEMAZEPAM"
z$z8[grep("TEMAZEPAM",z$z8)]<-"TEMAZEPAM"
z$z9[grep("TEMAZEPAM",z$z9)]<-"TEMAZEPAM"
z$z10[grep("TEMAZEPAM",z$z10)]<-"TEMAZEPAM"
z$z11[grep("TEMAZEPAM",z$z11)]<-"TEMAZEPAM"
z$z12[grep("TEMAZEPAM",z$z12)]<-"TEMAZEPAM"
z$z13[grep("TEMAZEPAM",z$z13)]<-"TEMAZEPAM"
#detecting each drug presence on the primary cause when opioid=true
fun.detect<-function(x, text="COCAINE") {
result<-c()
for(i in 1:nrow(x)){
result[i]<-ifelse(any(str_detect(x[i,], pattern=text) %in% TRUE), 1, 0)
}
result
}
#COCAINE
COCAINE<-fun.detect(z,text="COCAINE")
#  METHYLENEDIOXYMETHAMPHETAMINE / MDMA
MDMA<-fun.detect(z,text="MDMA")
# MDA
MDA<-fun.detect(z,text="MDA")
# METHAMPHETAMINE/METHA
METHAMPHETAMINE<-fun.detect(z,text="MAT_MINE")
#AMPHETAMINEMETHYLPHENIDATE
AMPHETAMINE<-fun.detect(z,text="AMPHETAMINE")
METHYLPHENIDATE<-fun.detect(z,text="METHYLPHENIDATE")
#MITRAGYNINE
MITRAGYNINE<-fun.detect(z,text="MITRAGYNINE")
# PHENCYCLIDINE(PCP)
PCP<-fun.detect(z,text="PCP")
#KETAMINE
KETAMINE<-fun.detect(z,text="KETAMINE")
# LYSERGIC ACID DIETHYLAMIDE(LSD)
LSD<-fun.detect(z,text="LSD")
#BENZODIAZEPINE
BENZODIAZEPINE<-fun.detect(z,text = "BENZODIAZEPINE")
#BARBITURATE
BARBITURATE<-fun.detect(z,text="BARBITURATE")
#HYPOXIC/ISCHEMIC
HYPOXIC<-fun.detect(z,text="HYPOXIC/ISCHEMIC")
#CYCLOBENZAPRINE
CYCLOBENZAPRINE<-fun.detect(z,text="CYCLOBENZAPRINE")
#METAXALONE
METAXALONE<-fun.detect(z,text="METAXALONE")
#METHOCARBAMOL
METHOCARBAMOL<-fun.detect(z,text="METHOCARBAMOL")
# CARISOPRODOL
CARISOPRODOL<-fun.detect(z,text="CARISOPRODOL")
#TIZANIDINE
TIZANIDINE<-fun.detect(z,text="TIZANIDINE")
#HEROIN
HEROIN<-fun.detect(z,text="HEROIN")
#METHADONE
METHADONE<-fun.detect(z,text="METHADONE")
#METHOXYACETYLFENTANYL/MAF
MAF<-fun.detect(z,text="MAF")
#ACETYL FENTANYL
ACETYL<-fun.detect(z,text="ACETYL")
#PARA-FLUOROBUTYRYL FENTANYL/FIBF
FIBF<-fun.detect(z,text="FIBF")
#BUTYRYL FENTANYL/ISOBUTYRYL FENTANYL
BUTYRYL<-fun.detect(z,text="BUTYRYL")
#DESPROPIONYL FENTANYL (4-ANPP)
#DESPROPRIONYL
ANPP_4<-fun.detect(z,text="4-ANPP")
#CYCLOPROPYL FENTANYL
CYCLOPROPYL<-fun.detect(z,text="CYCLOPROPYL")
#CARFENTANYL/CARFENTANIL
CARFENTANIL<-fun.detect(z,text="CARFENTANIL")
#2-FURANYL FENTANYL
FURANYL_2<-fun.detect(z,text="2-FURANYL")
#NORFENTANYL/NFL
NORFENTANYL<-fun.detect(z,text="NFL")
#VALERYLFENTANYL/VFL
VALERYLFENTANYL<-fun.detect(z,text="VFL")
#ACRYL FENTANYL
ACRYL<-fun.detect(z,text="ACRYL")
#PARA-FLUOROFENTANYL/PFL
PFL<-fun.detect(z,text="PFL")
#FENTANYL
FENTANYL<-fun.detect(z,text="FENTANYL")
#HYDROMORPHONE
#############################
HYDROMORPHONE<-fun.detect(z,text="HYDROMORPHONE")
# MORPHINE
MORPHINE<-fun.detect(z,text="MORPHINE")
#OXYMORPHONE
OXYMORPHONE<-fun.detect(z,text="OXYMORPHONE")
#OXYCODONE
OXYCODONE<-fun.detect(z,text="OXYCODONE")
#HYDROCODONE
HYDROCODONE<-fun.detect(z,text="HYDROCODONE")
#DIHYDROCODEINE/HYDROCODOL
HYDROCODOL<-fun.detect(z,text="HYDROCODOL")
#CODEINE
CODEINE<-fun.detect(z,text="CODEINE")
#BUPRENORPHINE
BUPRENORPHINE<-fun.detect(z,text="BUPRENORPHINE")
#MEPERIDINE
MEPERIDINE<-fun.detect(z,text="MEPERIDINE")
#TRAMADOL
TRAMADOL<-fun.detect(z,text="TRAMADOL")
#TRAZODONE
TRAZODONE<-fun.detect(z,text="TRAZODONE")
#DEXTROMETHORPHAN/LEVOMETHORPHAN
LEVOMETHORPHAN<-fun.detect(z,text="LEVOMETHORPHAN")
#DEXTRORPHAN/LEVORPHANOL
LEVORPHANOL<-fun.detect(z,text="LEVORPHANOL")
#U-47700
U_47700<-fun.detect(z,text="U-47700")
#U-49900
U_49900<-fun.detect(z,text="U-49900")
#ETHANOL
ETHANOL<-fun.detect(z,text="ETHANOL")
#OPIOID
OPIOID<-fun.detect(z,text="OPIOID")
#OPIATE
OPIATE<-fun.detect(z,text="OPIATE")
#3-fluorophenmetrazine [3-FPM]
FPM_3<-fun.detect(z,text="3-FPM")
#7-AMINOCLONAZEPAM
AMINOCLONAZEPAM_7<-fun.detect(z,text="7-AMINO")
#CLONAZEPAM [Klonopin]
CLONAZEPAM<-fun.detect(z,text="CLONAZEPAM")
#DELORAZEPAM
DELORAZEPAM<-fun.detect(z,text="DEL_PAM")
#DIAZEPAM[Valium]
########################
DIAZEPAM<-fun.detect(z,text="DIAZEPAM")
#DICLAZEPAM
DICLAZEPAM<-fun.detect(z,text="DICLAZEPAM")
#ETIZOLAM
ETIZOLAM<-fun.detect(z,text="ETIZOLAM")
#LORAZEPAM [Ativan]
LORAZEPAM<-fun.detect(z,text="LORAZEPAM")
#MIDAZOLAM [Versed]
MIDAZOLAM<-fun.detect(z,text="MIDAZOLAM")
#NORDIAZEPAM
NORDIAZEPAM<-fun.detect(z,text="NORDIAZEPAM")
TEMAZEPAM<-fun.detect(z,text="TEMAZEPAM")
#making a csv format file
drug<-cbind(COCAINE,MDMA,MDA,OPIOID,OPIATE,METHAMPHETAMINE,AMPHETAMINE,METHYLPHENIDATE,MITRAGYNINE,
PCP,KETAMINE,LSD,BENZODIAZEPINE,BARBITURATE,HYPOXIC,CYCLOBENZAPRINE,METAXALONE,
METHOCARBAMOL,CARISOPRODOL,TIZANIDINE,HEROIN,METHADONE,MAF,ACETYL,FIBF,BUTYRYL,
ANPP_4,CYCLOPROPYL,CARFENTANIL,FURANYL_2,NORFENTANYL,VALERYLFENTANYL,ACRYL,
PFL,FENTANYL,HYDROMORPHONE,MORPHINE,OXYMORPHONE,OXYCODONE,HYDROCODONE,
HYDROCODOL,CODEINE,BUPRENORPHINE,MEPERIDINE,TRAMADOL,TRAZODONE,LEVOMETHORPHAN,
LEVORPHANOL,U_47700,U_49900,ETHANOL,FPM_3,AMINOCLONAZEPAM_7,CLONAZEPAM,
DELORAZEPAM,DIAZEPAM,DICLAZEPAM,ETIZOLAM,LORAZEPAM,MIDAZOLAM,NORDIAZEPAM,
TEMAZEPAM)
fentanyl_all<-cbind(MAF,ACETYL,FIBF,BUTYRYL,ANPP_4,CYCLOPROPYL,CARFENTANIL,
FURANYL_2,NORFENTANYL,VALERYLFENTANYL,ACRYL,PFL,FENTANYL)
fun_count<-function(x){
result<-c()
for(i in 1:nrow(x)){
result[i]<-ifelse(any(x[i,]>0) %in% TRUE,1,0)
}
result
}
#count all types of fentanyl as fentanyl
fentanyl_All<-fun_count(fentanyl_all)
#primary cause
primary_cause<-county$Primary.Cause.Line.A
primary_id<-county$Case.Number
Death_Date<-county$Date.of.Death
drug<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
drug$Death_Date<-strptime(drug$Death_Date, format="%y%y-%m-%d")
drug <-filter(drug, Death_Date>= as.Date('2014-08-01 EDT') & Death_Date<= as.Date('2018-08-15 EDT'))
fun_count1<-function(x){
result<-c()
for(i in 1:nrow(x)){
result[i]<-ifelse(any(x[i,]>0) %in% TRUE,1,0)
}
result
}
fentanyl<-data.frame(drug$fentanyl_All,drug$CARFENTANIL,
drug$ANPP_4,drug$U_47700)
count1<-fun_count1(fentanyl)
nonfentanyl1<-data.frame(drug$COCAINE,drug$MDMA,drug$MDA,drug$METHAMPHETAMINE,
drug$AMPHETAMINE,drug$LSD,drug$FPM_3,drug$AMINOCLONAZEPAM_7,
drug$CLONAZEPAM,drug$DELORAZEPAM,drug$DIAZEPAM,
drug$DICLAZEPAM,drug$ETIZOLAM,drug$LORAZEPAM,
drug$MIDAZOLAM,drug$NORDIAZEPAM,drug$TEMAZEPAM)
nonfentanyl2<-data.frame(drug$HEROIN,drug$CODEINE,drug$METHADONE,
drug$MORPHINE,drug$HYDROCODONE,drug$TRAMADOL,
drug$OXYCODONE,drug$OXYMORPHONE,drug$BUPRENORPHINE,
drug$MITRAGYNINE,drug$OPIOID,drug$OPIATE)
nonfentanyl<-data.frame(nonfentanyl1,nonfentanyl2)
count3<-fun_count1(nonfentanyl)
print("count1")
print(count1)
print("count3")
print(count3)
print("primary_id")
print(fentanyl)
print("nonfentanyl")
print(nonfentanyl)
fent<-data.frame(count1,count3,primary_id,primary_cause,
fentanyl,nonfentanyl)
drug<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
#primary cause
primary_cause<-county$Primary.Cause.Line.A
primary_id<-county$Case.Number
Death_Date<-county$Date.of.Death
drug<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
#making a csv format file
drug<-cbind(COCAINE,MDMA,MDA,OPIOID,OPIATE,METHAMPHETAMINE,AMPHETAMINE,METHYLPHENIDATE,MITRAGYNINE,
PCP,KETAMINE,LSD,BENZODIAZEPINE,BARBITURATE,HYPOXIC,CYCLOBENZAPRINE,METAXALONE,
METHOCARBAMOL,CARISOPRODOL,TIZANIDINE,HEROIN,METHADONE,MAF,ACETYL,FIBF,BUTYRYL,
ANPP_4,CYCLOPROPYL,CARFENTANIL,FURANYL_2,NORFENTANYL,VALERYLFENTANYL,ACRYL,
PFL,FENTANYL,HYDROMORPHONE,MORPHINE,OXYMORPHONE,OXYCODONE,HYDROCODONE,
HYDROCODOL,CODEINE,BUPRENORPHINE,MEPERIDINE,TRAMADOL,TRAZODONE,LEVOMETHORPHAN,
LEVORPHANOL,U_47700,U_49900,ETHANOL,FPM_3,AMINOCLONAZEPAM_7,CLONAZEPAM,
DELORAZEPAM,DIAZEPAM,DICLAZEPAM,ETIZOLAM,LORAZEPAM,MIDAZOLAM,NORDIAZEPAM,
TEMAZEPAM)
fentanyl_all<-cbind(MAF,ACETYL,FIBF,BUTYRYL,ANPP_4,CYCLOPROPYL,CARFENTANIL,
FURANYL_2,NORFENTANYL,VALERYLFENTANYL,ACRYL,PFL,FENTANYL)
fun_count<-function(x){
result<-c()
for(i in 1:nrow(x)){
result[i]<-ifelse(any(x[i,]>0) %in% TRUE,1,0)
}
result
}
#count all types of fentanyl as fentanyl
fentanyl_All<-fun_count(fentanyl_all)
#primary cause
primary_cause<-county$Primary.Cause.Line.A
primary_id<-county$Case.Number
Death_Date<-county$Date.of.Death
drug<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
view(drug)
View(drug)
nonfentanyl1<-data.frame(drug2$COCAINE,drug2$MDMA,drug2$MDA,drug2$METHAMPHETAMINE,
drug2$AMPHETAMINE,drug2$LSD,drug2$FPM_3,drug2$AMINOCLONAZEPAM_7,
drug2$CLONAZEPAM,drug2$DELORAZEPAM,drug2$DIAZEPAM,
drug2$DICLAZEPAM,drug2$ETIZOLAM,drug2$LORAZEPAM,
drug2$MIDAZOLAM,drug2$NORDIAZEPAM,drug2$TEMAZEPAM)
#primary cause
primary_cause<-county$Primary.Cause.Line.A
primary_id<-county$Case.Number
Death_Date<-county$Date.of.Death
drug2<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
drug2$Death_Date<-strptime(drug2$Death_Date, format="%y%y-%m-%d")
drug2 <-filter(drug2, Death_Date>= as.Date('2014-08-01 EDT') & Death_Date<= as.Date('2018-08-15 EDT'))
fun_count1<-function(x){
result<-c()
for(i in 1:nrow(x)){
result[i]<-ifelse(any(x[i,]>0) %in% TRUE,1,0)
}
result
}
fentanyl<-data.frame(drug2$fentanyl_All,drug2$CARFENTANIL,
drug2$ANPP_4,drug2$U_47700)
fentanyl<-data.frame(drug2$fentanyl_All,drug2$CARFENTANIL,
drug2$ANPP_4,drug2$U_47700)
count1<-fun_count1(fentanyl)
nonfentanyl1<-data.frame(drug2$COCAINE,drug2$MDMA,drug2$MDA,drug2$METHAMPHETAMINE,
drug2$AMPHETAMINE,drug2$LSD,drug2$FPM_3,drug2$AMINOCLONAZEPAM_7,
drug2$CLONAZEPAM,drug2$DELORAZEPAM,drug2$DIAZEPAM,
drug2$DICLAZEPAM,drug2$ETIZOLAM,drug2$LORAZEPAM,
drug2$MIDAZOLAM,drug2$NORDIAZEPAM,drug2$TEMAZEPAM)
View(drug)
View(z)
View(z)
#making a csv format file
drug<-cbind(COCAINE,MDMA,MDA,OPIOID,OPIATE,METHAMPHETAMINE,AMPHETAMINE,METHYLPHENIDATE,MITRAGYNINE,
PCP,KETAMINE,LSD,BENZODIAZEPINE,BARBITURATE,HYPOXIC,CYCLOBENZAPRINE,METAXALONE,
METHOCARBAMOL,CARISOPRODOL,TIZANIDINE,HEROIN,METHADONE,MAF,ACETYL,FIBF,BUTYRYL,
ANPP_4,CYCLOPROPYL,CARFENTANIL,FURANYL_2,NORFENTANYL,VALERYLFENTANYL,ACRYL,
PFL,FENTANYL,HYDROMORPHONE,MORPHINE,OXYMORPHONE,OXYCODONE,HYDROCODONE,
HYDROCODOL,CODEINE,BUPRENORPHINE,MEPERIDINE,TRAMADOL,TRAZODONE,LEVOMETHORPHAN,
LEVORPHANOL,U_47700,U_49900,ETHANOL,FPM_3,AMINOCLONAZEPAM_7,CLONAZEPAM,
DELORAZEPAM,DIAZEPAM,DICLAZEPAM,ETIZOLAM,LORAZEPAM,MIDAZOLAM,NORDIAZEPAM,
TEMAZEPAM)
View(drug)
View(geocoded_case_archives)
View(drug2)
View(drug)
drug2<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
View(drug2)
drug2$Death_Date<-strptime(drug2$Death_Date, format="%y%y-%m-%d")
drug2<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
help(strptime)
drug2$Death_Date<-strptime(drug2$Death_Date, format="%Y-%m-%d")
drug2<-data.frame(primary_id,primary_cause,Death_Date,drug,fentanyl_All)
drug2$Death_Date<-strptime(drug2$Death_Date, format="%m/%d/%Y")
drug2 <-filter(drug2, Death_Date>= as.Date('2014-08-01') & Death_Date<= as.Date('2018-08-15 EDT'))
drug2 <-filter(drug2, Death_Date>= as.Date('2014-08-01') & Death_Date<= as.Date('2018-08-15 EDT'))
fun_count1<-function(x){
result<-c()
for(i in 1:nrow(x)){
result[i]<-ifelse(any(x[i,]>0) %in% TRUE,1,0)
}
result
}
fentanyl<-data.frame(drug2$fentanyl_All,drug2$CARFENTANIL,
drug2$ANPP_4,drug2$U_47700)
count1<-fun_count1(fentanyl)
nonfentanyl1<-data.frame(drug2$COCAINE,drug2$MDMA,drug2$MDA,drug2$METHAMPHETAMINE,
drug2$AMPHETAMINE,drug2$LSD,drug2$FPM_3,drug2$AMINOCLONAZEPAM_7,
drug2$CLONAZEPAM,drug2$DELORAZEPAM,drug2$DIAZEPAM,
drug2$DICLAZEPAM,drug2$ETIZOLAM,drug2$LORAZEPAM,
drug2$MIDAZOLAM,drug2$NORDIAZEPAM,drug2$TEMAZEPAM)
nonfentanyl2<-data.frame(drug2$HEROIN,drug2$CODEINE,drug2$METHADONE,
drug2$MORPHINE,drug2$HYDROCODONE,drug2$TRAMADOL,
drug2$OXYCODONE,drug2$OXYMORPHONE,drug2$BUPRENORPHINE,
drug2$MITRAGYNINE,drug2$OPIOID,drug2$OPIATE)
nonfentanyl<-data.frame(nonfentanyl1,nonfentanyl2)
count3<-fun_count1(nonfentanyl)
fent<-data.frame(count1,count3,primary_id,primary_cause,
fentanyl,nonfentanyl)
fent<-data.frame(count1,count3,drug2$primary_id,drug2$primary_cause,
fentanyl,nonfentanyl)
index<-which(fent$count1==1&fent$count3==1)
fent$count3[index]<-0
colnames(fent)<-c("Fentanyl-Involved Fatal Overdoses",
"Nonfentanyl Opioid and Polydrug Fatal Overdoses",
"primary_id","primary_cause", "FENTANYL",
"CARFENTANIL","ANPP_4","U_47700","COCAINE","MDMA","MDA",
"METHAMPHETAMINE","AMPHETAMINE","LSD","FPM_3","AMINOCLONAZEPAM_7","CLONAZEPAM",
"DELORAZEPAM","DIAZEPAM","DICLAZEPAM","ETIZOLAM","LORAZEPAM","MIDAZOLAM",
"NORDIAZEPAM", "TEMAZEPAM","HEROIN", "CODEINE","METHADONE","MORPHINE",
"HYDROCODONE","TRAMADOL","OXYCODONE","OXYMORPHONE","BUPRENORPHINE","MITRAGYNINE",
"OPIOID", "OPIATE")
write_csv(fent,file="drug_classifications.csv")
source("~/Projects/Kentucky/chicago-geo/xylazine/ripleys-k.R")
source("~/Projects/Kentucky/chicago-geo/xylazine/ripleys-k.R")
combined_pattern <- ppp(case_and_controls$final_longitude, case_and_controls$final_latitude, c(-89, -87), c(41, 43), marks = case_and_controls$case,  checkdup = FALSE)
marks(combined_pattern) <- case_and_controls$case
View(case_and_controls)
unique(case_and_controls$case)
unique(case_and_controls$case_control)
marks(combined_pattern) <- case_and_controls$case
summary(combined_pattern)
combined_pattern <- ppp(case_and_controls$final_longitude, case_and_controls$final_latitude, c(-90, -86), c(40, 44), marks = case_and_controls$case,  checkdup = FALSE)
marks(combined_pattern) <- case_and_controls$case
combined_pattern <- ppp(case_and_controls$final_longitude, case_and_controls$final_latitude, c(-91, -85), c(39, 45), marks = case_and_controls$case,  checkdup = FALSE)
marks(combined_pattern) <- case_and_controls$case
combined_pattern <- ppp(case_and_controls$final_longitude, case_and_controls$final_latitude, c(-92, -84), c(38, 46), marks = case_and_controls$case,  checkdup = FALSE)
marks(combined_pattern) <- case_and_controls$case
summary(combined_pattern)
# use envelope and `kd` function from smacpod
comp_env <- envelope(combined_pattern, kd, nsim = 999)
plot(comp_env)
write.csv(comp_env, "fen_alc_compared_pattern.csv", row.names = FALSE)
# load packages
library(readr)
library(dplyr)
library(MatchIt)
# read csv
df <- read.csv("./combined.csv")
# read csv
df <- read.csv("./combined.csv")
# cleaning
df1 <-
df %>%
select(casenumber, age, race, gender, case_control) %>%
filter(complete.cases(.)) %>%
mutate(case = case_when(case_control == "xylazine" ~ 1, case_control == "fentanyl" ~ 0)) %>%
mutate_if(is.character, as.factor) %>%
filter(!is.na(case))
# match-it function
m2 <- matchit(case ~ age + race + gender, data = df1, method = "nearest", distance = "glm", ratio = 3)
print(summary(m2))
# match table
a <- match.data(m2)
View(a)
a2 <-
a %>%
left_join(df %>% select(casenumber, final_longitude, final_latitude)) %>%
select(matchnumber = subclass, casenumber, age, race, gender, casenumber, final_longitude, final_latitude, case_control, case, distance, weights) %>%
arrange(matchnumber, desc(case))
library(readr)
library(dplyr)
library(MatchIt)
a2 <-
a %>%
left_join(df %>% select(casenumber, final_longitude, final_latitude)) %>%
select(matchnumber = subclass, casenumber, age, race, gender, casenumber, final_longitude, final_latitude, case_control, case, distance, weights) %>%
arrange(matchnumber, desc(case))
View(a)
View(df1)
